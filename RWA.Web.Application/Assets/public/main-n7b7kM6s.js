import{c as Se,m as xe,a as $e,d as Re,b as Ne}from"./vuetify-vendor-TsjR0sxG.js";import{a4 as ke,d as R,r as pe,f as J,a5 as Te,j as ne,D as _e,a3 as f,a6 as x,a7 as p,N as ye,y as r,O as we,n as l,a8 as o,X as $,v as ce,F as X,a9 as ae,S as N,aa as O,w as ve,ab as G,u as V,a0 as Ae,J as Me,ac as Ve,ad as Ie}from"./vendor-B5oAHIpZ.js";import{H as Ee}from"./signalr-vendor-BwjK9eZE.js";const ie=ke("toast",()=>{const y=R([]);let s=1;function u(m){const w={id:s++,type:m.type||"info",message:m.message||""};return y.value.push(w),w.id}function g(m){y.value=y.value.filter(w=>w.id!==m)}function b(){y.value=[]}return{queue:y,pushToast:u,removeToast:g,clear:b}}),Fe=pe({isPosting:!1});function fe(){return Fe}async function de(y,s){const u=fe();u.isPosting=!0;try{const g=await fetch(y,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});return g.status===204?null:await g.json()}finally{const g=fe();g.isPosting=!1}}const me=ke("workflow",()=>{const y=R([]),s=J(()=>{const t=y.value.find(i=>i.status&&i.status.startsWith("Current"));if(!t||!t.dataPayload)return[];try{const i=JSON.parse(t.dataPayload);return Array.isArray(i)?i:[]}catch(i){return console.warn("[workflow.ts] Failed to parse DataPayload as validation messages:",i),[]}}),u=R(null),g=y,b=s,m=R(null),w=R(!1),P=R({}),C=R(null),I=R(0),k=R(["SuccessfulFinish","FinishedWithWarning"]),v=R(["CurrentWithError"]),W=R(["CurrentWithWarning"]);function H(t){y.value=t;const i=t.findIndex(T=>T.status&&T.status.startsWith("Current"));u.value=i>=0?i:0}function U(){return y.value.findIndex(t=>t.status&&t.status.startsWith("Current"))}function d(t){if(t==null)return;const i=U(),T=i>=0?i:Math.max(0,y.value.length-1);let B=Math.floor(Number(t)||0);B<0&&(B=0),B>T&&(B=T),u.value=B}let h=0;const M=2e3;async function D(){const t=Date.now();if(t-h<M){console.log("fetchWorkflowStatus throttled");return}h=t,w.value=!0,C.value=null;try{const i=await fetch("/api/workflow/status");if(!i.ok)throw new Error("Failed to fetch workflow status");const T=await i.json();H(Array.isArray(T)?T:[])}catch(i){i instanceof Error?C.value={errorMessage:i.message}:C.value={errorMessage:"An unknown error occurred"}}finally{w.value=!1}}async function j(){w.value=!0,C.value=null;try{await de("/api/workflow/revalidate",{})}catch(t){t instanceof Error?C.value={errorMessage:t.message}:C.value={errorMessage:"An unknown error occurred"}}finally{w.value=!1}}async function z(){w.value=!0,C.value=null;try{await de("/api/workflow/force-next",{})}catch(t){t instanceof Error?C.value={errorMessage:t.message}:C.value={errorMessage:"An unknown error occurred"}}finally{w.value=!1}}async function a(t){w.value=!0,C.value=null;try{await de(`/api/workflow/trigger/${t}`,{})}catch(i){i instanceof Error?C.value={errorMessage:i.message}:C.value={errorMessage:"An unknown error occurred"}}finally{w.value=!1}}async function e(){w.value=!0,C.value=null;try{await de("/api/workflow/reset",{}),I.value++}catch(t){t instanceof Error?C.value={errorMessage:t.message}:C.value={errorMessage:"An unknown error occurred"}}finally{w.value=!1}}function c(t,i){if(!t)return;const T={...P.value};T[t]=i,P.value=T}async function n(t){var T;w.value=!0,C.value=null;const i=fe();i.isPosting=!0;try{await Te.post("/api/workflow/upload",t)}catch(B){const Z=ie();if(B.response&&B.response.data){C.value=B.response.data;try{Z.pushToast({type:"error",message:typeof B.response.data=="string"?B.response.data:((T=B.response.data)==null?void 0:T.message)||JSON.stringify(B.response.data)})}catch{}}else{C.value={errorMessage:"An unknown error occurred."};try{Z.pushToast({type:"error",message:"Upload failed: unknown error"})}catch{}}}finally{w.value=!1,i.isPosting=!1}}function E(t){if(t<0)return!1;const i=y.value[t];return!i||!i.status?!1:k.value.includes(i.status)}function F(t){if(t<0)return!1;const i=y.value[t];return!i||!i.status?!1:k.value.includes(i.status)}function S(t){if(t<0)return!1;const i=y.value[t];return!i||!i.status?!1:v.value.includes(i.status)?!0:i.status.toLowerCase().includes("error")}function Q(t){if(t<0)return!1;const i=y.value[t];return!i||!i.status?!1:W.value.includes(i.status)?!0:i.status.toLowerCase().includes("warning")}function q(t){return S(t)||Q(t)}function K(){m.value=new Ee().withUrl("/workflowHub").build(),m.value.on("ReceiveWorkflowUpdate",t=>{console.log("[workflow.ts] Received workflow update:",t),console.log("[workflow.ts] Before update - Current step:",y.value.find(i=>{var T;return(T=i.status)==null?void 0:T.startsWith("Current")})),H(Array.isArray(t)?t:[]),console.log("[workflow.ts] After update - Current step:",y.value.find(i=>{var T;return(T=i.status)==null?void 0:T.startsWith("Current")})),console.log("[workflow.ts] Validation messages count:",s.value.length)}),m.value.on("ReceiveTransition",t=>{window.dispatchEvent(new CustomEvent("workflow-transition",{detail:t}))}),m.value.on("ReceiveToast",t=>{try{ie().pushToast(t||{})}catch{window.dispatchEvent(new CustomEvent("workflow-toast",{detail:t}))}}),m.value.start().catch(t=>console.error(t)),D(),fetch("/api/workflow/config").then(t=>t.ok?t.json():null).then(t=>{t&&(Array.isArray(t.AdvanceStatuses)&&(k.value=t.AdvanceStatuses),Array.isArray(t.ErrorStatuses)&&(v.value=t.ErrorStatuses))}).catch(()=>{})}function oe(t){d(t)}function se(){const t=u.value??U();d((t??0)+1)}function Y(){const t=u.value??U();d((t??0)-1)}function le(){const t=u.value??U();if(t==null||t>=y.value.length-1)return!1;for(let i=0;i<=t;i++)if(!E(i))return!1;return!0}return{workflowSteps:g,loading:w,error:C,currentValidationMessages:b,advanceStatuses:k,errorStatuses:v,stepLoading:P,setStepLoading:c,fetchWorkflowStatus:D,triggerTransition:a,resetWorkflow:e,uploadFiles:n,isStepAdvancable:E,isStepComplete:F,isStepError:S,isStepWarning:Q,isStepWithIssues:q,initSignalR:K,revalidateCurrent:j,forceNext:z,uiActiveIndex:u,navigateTo:oe,navigateNextVisual:se,navigatePrevVisual:Y,requestUiActiveIndex:d,canNavigateNext:le}}),We={class:"audit-header"},Oe={class:"audit-title"},Pe={class:"audit-cards"},Be=["onClick"],De={class:"card-content"},Ue={class:"card-icon"},je={class:"card-info"},Le={class:"card-title"},Je={class:"card-description"},ze={class:"card-stats"},He={class:"stat-badge"},qe={class:"audit-table-container"},Ge={class:"table-header"},Ke={class:"table-content"},Xe={key:1,class:"table-loading"},Qe={key:2,class:"table-empty"},Ye=ne({__name:"AuditPanel",setup(y){const s=R(!1),u=R(null),g=R(!1),b=pe([{name:"inventory",title:"Inventaire Normalisé",description:"Table principale du workflow - HecateInventaireNormalise",icon:"mdi-database",color:"primary",count:0,apiEndpoint:"/api/audit/inventory"},{name:"history",title:"Historique Interne",description:"Suivi des modifications - HecateInterneHistorique",icon:"mdi-history",color:"secondary",count:0,apiEndpoint:"/api/audit/history"}]),m=pe({inventory:[],history:[]}),w=pe({inventory:[],history:[]}),P=J(()=>{if(u.value===null)return[];const d=b[u.value].name;return m[d]}),C=J(()=>{if(u.value===null)return[];const d=b[u.value].name;return w[d].map(M=>({title:M.text,value:M.value}))}),I=()=>{s.value?v():k()},k=async()=>{s.value=!0,await H()},v=()=>{s.value=!1,u.value=null},W=async d=>{if(u.value===d){u.value=null;return}u.value=d;const h=b[d];m[h.name].length===0&&await U(h)},H=async()=>{try{for(const d of b){const h=await fetch(`${d.apiEndpoint}/count`);if(h.ok){const M=await h.json();d.count=M.count||0}}}catch(d){console.error("Error loading table counts:",d)}},U=async d=>{g.value=!0;try{const h=await fetch(`${d.apiEndpoint}/columns`);if(h.ok){const D=await h.json();w[d.name]=D.columns||[]}const M=await fetch(`${d.apiEndpoint}/data`);if(M.ok){const D=await M.json();m[d.name]=D.rows||[]}}catch(h){console.error(`Error loading ${d.name} data:`,h)}finally{g.value=!1}};return _e(async()=>{await H()}),(d,h)=>{var a;const M=f("v-icon"),D=f("v-btn"),j=f("v-data-table"),z=f("v-progress-circular");return p(),x("div",null,[ye(r("div",{class:ce(["audit-trigger",{active:s.value}]),onClick:I},[l(M,{size:"24",color:"primary"},{default:o(()=>h[0]||(h[0]=[$("mdi-chevron-right",-1)])),_:1,__:[0]})],2),[[we,!s.value]]),r("div",{class:ce(["audit-backdrop",{active:s.value}]),onClick:v},null,2),r("div",{class:ce(["audit-panel",{open:s.value}])},[r("div",We,[r("h3",Oe,[l(M,{class:"me-2"},{default:o(()=>h[1]||(h[1]=[$("mdi-chart-line",-1)])),_:1,__:[1]}),h[2]||(h[2]=$(" Audit du Workflow ",-1))]),l(D,{icon:"",size:"small",variant:"text",onClick:v},{default:o(()=>[l(M,null,{default:o(()=>h[3]||(h[3]=[$("mdi-close",-1)])),_:1,__:[3]})]),_:1})]),r("div",Pe,[(p(!0),x(X,null,ae(b,(e,c)=>(p(),x("div",{class:ce(["audit-card",{active:u.value===c}]),key:e.name,onClick:n=>W(c)},[r("div",De,[r("div",Ue,[l(M,{color:e.color,size:"32"},{default:o(()=>[$(N(e.icon),1)]),_:2},1032,["color"])]),r("div",je,[r("h4",Le,N(e.title),1),r("p",Je,N(e.description),1),r("div",ze,[r("span",He,N(e.count)+" enregistrements",1)])])])],10,Be))),128))]),ye(r("div",qe,[r("div",Ge,[r("h4",null,N((a=b[u.value])==null?void 0:a.title),1)]),r("div",Ke,[P.value.length>0?(p(),O(j,{key:0,headers:C.value,items:P.value,loading:g.value,class:"audit-table",density:"compact","items-per-page":25},null,8,["headers","items","loading"])):g.value?(p(),x("div",Xe,[l(z,{indeterminate:"",color:"primary"}),h[4]||(h[4]=r("p",null,"Chargement des données...",-1))])):(p(),x("div",Qe,[l(M,{size:"48",color:"grey"},{default:o(()=>h[5]||(h[5]=[$("mdi-database-off",-1)])),_:1,__:[5]}),h[6]||(h[6]=r("p",null,"Aucune donnée disponible",-1))]))])],512),[[we,u.value!==null]])],2)])}}}),ue=(y,s)=>{const u=y.__vccOpts||y;for(const[g,b]of s)u[g]=b;return u},Ze=ue(Ye,[["__scopeId","data-v-a5a4d63a"]]),Ce=/^RWA_Report_(\d{3})_(\d{2})(\d{4})/;function et(y){return y?Ce.test(y):!1}function he(y){const s=Array.isArray(y)?y:Array.from(y),u=[],g=[];return s.forEach(b=>{const m=typeof b=="string"?b:(b==null?void 0:b.name)??String(b);if(!et(m))u.push(m);else{const w=m.match(Ce);g.push(w?w[0]:"")}}),{valid:u.length===0,badNames:u,parsedMatches:g}}const tt={key:1},at=ne({__name:"UploadInventory",setup(y){const s=me(),u=R([]),g=R(""),b=R(null),m=R(!0),w=J(()=>{const k=s.workflowSteps.find(v=>v.stepName==="Upload inventory");return(k==null?void 0:k.status)==="SuccessfulFinish"});ve(u,k=>{const v=he(k||[]);(!b.value||JSON.stringify(b.value.badNames)!==JSON.stringify(v.badNames))&&(b.value=v,m.value=v.valid,v.valid||(g.value=`Invalid filenames: ${v.badNames.join(", ")}`,ie().pushToast({type:"warning",message:g.value})))},{deep:!0}),ve(()=>s.workflowSteps,k=>{const v=(k||[]).find(W=>W.stepName==="Upload inventory");(!v||!v.dataPayload)&&(u.value=[])},{deep:!0}),ve(()=>s.resetCounter,()=>{u.value=[]});const P=async()=>{const k=he(u.value||[]);if(!k.valid){g.value=`Invalid filenames: ${k.badNames.join(", ")}`,ie().pushToast({type:"warning",message:g.value});return}const v=new FormData;for(const W of u.value)v.append("file",W);await s.uploadFiles(v),u.value=[]},C=J(()=>{const k=s.workflowSteps.find(W=>W.status.startsWith("Current"));if(!k||!k.dataPayload)return[];const v=JSON.parse(k.dataPayload);return v.Messages?v.Messages[0].ErrorData:[]}),I=J(()=>{const k=s.workflowSteps.find(W=>W.status.startsWith("Current"));if(!k||!k.dataPayload)return null;const v=JSON.parse(k.dataPayload);return v.Messages?v.Messages[0].Message:null});return(k,v)=>{const W=f("v-alert"),H=f("v-chip"),U=f("v-file-input"),d=f("v-btn"),h=f("v-col"),M=f("v-row"),D=f("v-data-table"),j=f("v-container");return p(),O(j,null,{default:o(()=>[w.value?(p(),O(W,{key:0,type:"success",variant:"outlined",class:"mb-4"},{default:o(()=>v[2]||(v[2]=[$(" This step is successfully finished. ",-1)])),_:1,__:[2]})):(p(),x("div",tt,[l(M,null,{default:o(()=>[l(h,null,{default:o(()=>[v[5]||(v[5]=r("h3",null,"Upload Inventory Files",-1)),l(U,{modelValue:u.value,"onUpdate:modelValue":v[0]||(v[0]=z=>u.value=z),"show-size":1e3,color:"deep-purple-accent-4",label:"File input",placeholder:"Select your files",variant:"outlined",counter:"",multiple:"",accept:".xlsx"},{selection:o(({fileNames:z})=>[(p(!0),x(X,null,ae(z,(a,e)=>(p(),O(H,{key:a,class:"me-2",color:"deep-purple-accent-4",size:"small",label:"",closable:"","onClick:close":c=>u.value.splice(e,1)},{default:o(()=>[$(N(a),1)]),_:2},1032,["onClick:close"]))),128))]),_:1},8,["modelValue"]),l(d,{onClick:P,disabled:u.value.length===0||!m.value},{default:o(()=>v[3]||(v[3]=[$("Upload",-1)])),_:1,__:[3]},8,["disabled"]),I.value?(p(),O(d,{key:0,onClick:v[1]||(v[1]=z=>V(s).triggerTransition("Revalidate"))},{default:o(()=>v[4]||(v[4]=[$("Revalidate",-1)])),_:1,__:[4]})):G("",!0)]),_:1,__:[5]})]),_:1}),I.value?(p(),O(M,{key:0},{default:o(()=>[l(h,null,{default:o(()=>[l(W,{type:"error",class:"mb-4"},{default:o(()=>[$(N(I.value),1)]),_:1}),l(D,{headers:[{title:"Identifiant Origine",value:"IdentifiantOrigine"}],items:C.value},null,8,["items"])]),_:1})]),_:1})):G("",!0)]))]),_:1})}}}),nt={key:1},ot={key:0},st={key:1,class:"text-center py-8"},lt={key:2},rt={class:"text-caption text--secondary"},it={class:"font-weight-medium"},ut={class:"text-body-2"},ct={class:"text-body-2"},dt={style:{display:"flex",gap:"8px","align-items":"center"}},pt={style:{display:"flex",gap:"8px","align-items":"center"}},vt={class:"d-flex gap-3"},ft={key:0,class:"text-caption text--secondary"},mt={key:0,class:"ml-2 text--disabled"},_t=ne({__name:"RwaCategoryManager",setup(y){const s=me(),u=R([]),g=R(!1),b=R(!0),m=R({}),w=R({}),P=R({}),C=R(""),I=R([]),k=R([]),v=J(()=>{if(!C.value||C.value.trim()==="")return u.value;const c=C.value.toLowerCase().trim();return u.value.filter(n=>d(n).toLowerCase().includes(c))}),W=J(()=>v.value.filter(c=>{const n=d(c);return m.value[n]}).length),H=J(()=>Object.keys(m.value).filter(c=>m.value[c]).length);function U(c){P.value[c]=!0}function d(c){return c.Identifiant||""}function h(c){const n=d(c),E=m.value[n],F=w.value[n];return E&&F?"row-complete":E?"row-partial":"row-incomplete"}const M=[{title:"Identifiant",value:"Identifiant"},{title:"Source",value:"Source"},{title:"Cat1",value:"Cat1"},{title:"Cat2",value:"Cat2"},{title:"Categorie RWA",value:"categorieRwa"},{title:"Type Bloomberg",value:"typeBloomberg"}];function D(){const c=s.workflowSteps.find(n=>n.stepName==="RWA Category Manager");if(console.log("RWA Category Manager step:",c),c!=null&&c.dataPayload){console.log("Raw dataPayload:",c.dataPayload);const n=JSON.parse(c.dataPayload);console.log("Parsed payload:",n),console.log("Payload keys:",Object.keys(n)),u.value=n.MissingMappingRows||n.missingMappingRows||[],console.log("Loaded rows:",u.value);const E=n.CategorieRwaOptions||n.categorieRwaOptions||[],F=n.TypeBloombergOptions||n.typeBloombergOptions||[];console.log("Raw Categorie options from payload:",E),console.log("First categorie option structure:",E[0]),I.value=E.map(S=>({title:S.Libelle||S.libelle||S.Title||S.title,value:S.IdCatRwa||S.idCatRwa||S.Value||S.value||S.Id||S.id})),console.log("Mapped Categorie options:",I.value),console.log("categorieRwaOptions.value length:",I.value.length),console.log("Raw Type Bloomberg options from payload:",F),console.log("First type bloomberg option structure:",F[0]),k.value=F.map(S=>({title:S.Libelle||S.libelle||S.Title||S.title,value:S.IdTypeBloomberg||S.idTypeBloomberg||S.Value||S.value||S.Id||S.id})),console.log("Mapped Type Bloomberg options:",k.value),console.log("typeBloombergOptions.value length:",k.value.length),u.value.forEach(S=>{m.value[S.Identifiant]=S.ChosenCategorieRwa||null,w.value[S.Identifiant]=S.ChosenTypeBloomberg||null,P.value[S.Identifiant]=!1})}}_e(async()=>{g.value=!0;try{D()}finally{g.value=!1}}),ve(()=>s.workflowSteps,()=>{console.log("Workflow steps changed, reloading RWA Category Manager data"),D()},{deep:!0});const j=J(()=>u.value.some(c=>!m.value[d(c)])),z=J(()=>{const c=s.workflowSteps.find(n=>n.stepName==="RWA Category Manager");return(c==null?void 0:c.status)==="SuccessfulFinish"});async function a(){g.value=!0;try{const c=u.value.filter(n=>m.value[d(n)]).map(n=>({identifiant:d(n),source:n.Source||n.source,cat1:n.Cat1||n.cat1,cat2:n.Cat2||n.cat2,categorieRwaId:m.value[d(n)],typeBloombergId:w.value[d(n)]||null}));if(c.length>0&&!(await fetch("/api/workflow/rwa-mappings",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({mappings:c})})).ok)throw new Error("Failed to submit mappings")}finally{g.value=!1}}async function e(){D()}return(c,n)=>{const E=f("v-col"),F=f("v-row"),S=f("v-alert"),Q=f("v-skeleton-loader"),q=f("v-icon"),K=f("v-progress-circular"),oe=f("v-text-field"),se=f("v-spacer"),Y=f("v-select"),le=f("v-data-table"),t=f("v-btn"),i=f("v-form"),T=f("v-card-text"),B=f("v-card"),Z=f("v-container");return p(),O(Z,null,{default:o(()=>[l(B,null,{default:o(()=>[l(T,null,{default:o(()=>[z.value?(p(),O(S,{key:0,type:"success",prominent:"",border:"start",class:"mb-6"},{default:o(()=>[l(F,{align:"center"},{default:o(()=>[l(E,{class:"grow"},{default:o(()=>n[2]||(n[2]=[$(" This step is successfully finished ",-1)])),_:1,__:[2]})]),_:1})]),_:1})):(p(),x("div",nt,[l(i,{ref:"form",modelValue:b.value,"onUpdate:modelValue":n[1]||(n[1]=_=>b.value=_)},{default:o(()=>[g.value?(p(),x("div",ot,[l(Q,{type:"table",loading:g.value,"aria-busy":"true"},null,8,["loading"])])):u.value.length===0?(p(),x("div",st,[l(q,{size:"48",color:"grey",class:"mb-4"},{default:o(()=>n[3]||(n[3]=[$("mdi-table-search",-1)])),_:1,__:[3]}),n[4]||(n[4]=r("h3",{class:"text-h6 grey--text mb-2"},"Waiting for category mapping data...",-1)),n[5]||(n[5]=r("p",{class:"text-body-2 grey--text"},"The system is processing category mappings via SignalR.",-1)),l(K,{indeterminate:"",color:"primary",class:"mt-4"})])):(p(),x("div",lt,[l(F,{class:"mb-4"},{default:o(()=>[l(E,{cols:"12",md:"6"},{default:o(()=>[l(oe,{modelValue:C.value,"onUpdate:modelValue":n[0]||(n[0]=_=>C.value=_),"prepend-inner-icon":"mdi-magnify",label:"Search by Identifiant...",outlined:"",dense:"",clearable:"","hide-details":"",placeholder:"Filter rows by identifiant"},null,8,["modelValue"])]),_:1}),l(se),l(E,{cols:"auto",class:"d-flex align-center"},{default:o(()=>[r("span",rt,N(v.value.length)+" / "+N(u.value.length)+" rows ",1)]),_:1})]),_:1}),l(le,{items:v.value,headers:M,"item-key":d,class:"elevation-1 rwa-data-table",role:"table","items-per-page":10,"footer-props":{"items-per-page-options":[5,10,20,-1]},"item-class":h,loading:g.value,"loading-text":"Loading category mappings..."},{"item.Identifiant":o(({item:_})=>[r("span",it,N(_.Identifiant),1)]),"item.Source":o(({item:_})=>[r("span",null,N(_.Source),1)]),"item.Cat1":o(({item:_})=>[r("span",ut,N(_.Cat1),1)]),"item.Cat2":o(({item:_})=>[r("span",ct,N(_.Cat2||"-"),1)]),"item.categorieRwa":o(({item:_})=>[r("div",dt,[l(Y,{items:I.value,modelValue:m.value[d(_)],"onUpdate:modelValue":[L=>m.value[d(_)]=L,()=>U(d(_))],"item-title":"title","item-value":"value",variant:"outlined",density:"compact","hide-details":"",class:"rwa-select",placeholder:"Select RWA Category","prepend-inner-icon":"mdi-tag-outline",clearable:"",error:P.value[d(_)]&&!m.value[d(_)],"error-messages":P.value[d(_)]&&!m.value[d(_)]?["Required"]:[],onBlur:()=>U(d(_)),style:{"min-width":"250px"},"aria-label":`Categorie RWA for ${d(_)}`},null,8,["items","modelValue","onUpdate:modelValue","error","error-messages","onBlur","aria-label"])])]),"item.typeBloomberg":o(({item:_})=>[r("div",pt,[l(Y,{items:k.value,modelValue:w.value[d(_)],"onUpdate:modelValue":L=>w.value[d(_)]=L,"item-title":"title","item-value":"value",variant:"outlined",density:"compact","hide-details":"",class:"rwa-select",placeholder:"Select Bloomberg Type (Optional)","prepend-inner-icon":"mdi-chart-line",clearable:"",style:{"min-width":"280px"},"aria-label":`Type Bloomberg for ${d(_)}`},null,8,["items","modelValue","onUpdate:modelValue","aria-label"])])]),_:1},8,["items","loading"]),l(F,{class:"mt-6"},{default:o(()=>[l(E,{cols:"12",class:"d-flex justify-space-between align-center"},{default:o(()=>[r("div",vt,[l(t,{disabled:!b.value||j.value||g.value,color:"primary",elevation:"2",large:"",onClick:a,"aria-label":"Submit mappings"},{default:o(()=>[l(q,{left:""},{default:o(()=>[$(N(g.value?"mdi-loading mdi-spin":"mdi-check-circle"),1)]),_:1}),g.value?(p(),O(K,{key:0,indeterminate:"",size:"18",width:"2",color:"white",class:"mr-2"})):G("",!0),$(" "+N(g.value?"Submitting...":"Submit Mappings"),1)]),_:1},8,["disabled"]),l(t,{outlined:"",color:"secondary",large:"",onClick:e,"aria-label":"Reload missing rows"},{default:o(()=>[l(q,{left:""},{default:o(()=>n[6]||(n[6]=[$("mdi-refresh",-1)])),_:1,__:[6]}),n[7]||(n[7]=$(" Reload Data ",-1))]),_:1,__:[7]})]),v.value.length>0?(p(),x("div",ft,[$(N(W.value)+" / "+N(v.value.length)+" mapped ",1),C.value&&v.value.length!==u.value.length?(p(),x("span",mt," ("+N(H.value)+" / "+N(u.value.length)+" total) ",1)):G("",!0)])):G("",!0)]),_:1})]),_:1})]))]),_:1},8,["modelValue"])]))]),_:1})]),_:1})]),_:1})}}}),gt=ue(_t,[["__scopeId","data-v-25d8b58b"]]),yt={};function wt(y,s){return p(),x("div",null,s[0]||(s[0]=[r("h3",null,"BDD Manager",-1),r("p",null,"Content for this step goes here.",-1)]))}const ht=ue(yt,[["render",wt]]),bt={};function kt(y,s){return p(),x("div",null,s[0]||(s[0]=[r("h3",null,"RAF Manager",-1),r("p",null,"Content for this step goes here.",-1)]))}const Ct=ue(bt,[["render",kt]]),St={};function xt(y,s){return p(),x("div",null,s[0]||(s[0]=[r("h3",null,"Fichier Enrichi Generation",-1),r("p",null,"Content for this step goes here.",-1)]))}const $t=ue(St,[["render",xt]]),Rt={key:0},Nt=["colspan","onClick"],Tt={class:"d-flex align-center"},At={class:"ms-4"},Mt={class:"d-flex align-center justify-space-between"},Vt={class:"d-flex align-center"},It={class:"mt-3"},Et={key:0},Ft={style:{"white-space":"pre-wrap","word-break":"break-word","max-height":"360px",overflow:"auto"}},Wt={key:1},Ot={key:0},Pt={class:"font-weight-medium"},Bt={key:0},Dt={key:1},Ut={key:2},jt={style:{padding:"6px 8px"}},Lt={style:{"white-space":"pre-wrap","word-break":"break-word",margin:"0"}},Jt={key:1},zt={class:"mt-2"},Ht={key:5},qt={class:"d-flex justify-space-between mt-4"},Gt=ne({__name:"WorkflowView",setup(y){const s=me(),u=[{title:"Type",key:"Status"},{title:"File",key:"FileName"},{title:"Message",key:"Message"}],g=R({});function b(a){const e=w(a);g.value[e]=!g.value[e]}function m(a){return!!g.value[w(a)]}function w(a){return a?a.id?`id:${a.id}`:a.message?`msg:${a.message}`:JSON.stringify(a).slice(0,64):"__unknown__"}function P(a){if(!a)return{};if(Array.isArray(a)){const e={};return a.forEach(c=>{const n=c&&(c.validator||c.name)||"details";e[n]||(e[n]=[]),e[n].push(c)}),e}if(typeof a=="object"){const e=Object.keys(a);return e.length>0&&e.some(n=>typeof a[n]!="string")?a:{details:[a]}}return{details:[a]}}function C(a){if(!Array.isArray(a)||a.length===0)return[];const e=a[0];return!e||typeof e!="object"||Array.isArray(e)?[]:Object.keys(e)}function I(a){const e=C(a);return e.length>0?e.map(c=>({title:c,key:c})):[{title:"Details",key:"_detail"}]}function k(a){return a?Array.isArray(a)?a.map(e=>e&&typeof e=="object"?e:{_detail:e}):[{_detail:a}]:[]}function v(a){return!!a&&a.toLowerCase().includes("assetid")}function W(a){return!!a&&a.toLowerCase().includes("uploadtemplate")}function H(a){return a?Array.isArray(a)?a.map(e=>({filename:((e==null?void 0:e.SavedFilePath)??(e==null?void 0:e.FileName)??(e==null?void 0:e.Fichier)??(e==null?void 0:e.filename)??(e==null?void 0:e.fileName)??"")||"(unknown file)",message:"This file contains empty Asset IDs"})):[{filename:"(unknown file)",message:String(a)}]:[]}function U(a){var c,n;return a?((a==null?void 0:a.FileName)??(a==null?void 0:a.fileName)??((c=a==null?void 0:a.ErrorData)==null?void 0:c.SavedFilePath)??((n=a==null?void 0:a.errorData)==null?void 0:n.FileName))||"(general validation)":""}function d(a){if(!a)return"";if(typeof a=="number")return a===2?"Error":a===1?"Warning":"Success";const e=String(a).toLowerCase();return e.includes("error")?"Error":e.includes("warning")?"Warning":String(a)}const h=J(()=>(s.currentValidationMessages||[]).some(e=>d(e.status)==="Warning"));async function M(a){const e=a&&(a.errorData??a.ErrorData??a),c=typeof e=="object"?JSON.stringify(e,null,2):String(e??"");try{if(navigator&&navigator.clipboard&&navigator.clipboard.writeText){await navigator.clipboard.writeText(c);return}}catch{}try{const n=document.createElement("textarea");n.value=c,n.style.position="fixed",n.style.left="-9999px",document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n)}catch{const E=window.open("","_blank");E&&(E.document.write("<pre>"+c.replace(/</g,"&lt;")+"</pre>"),E.document.close())}}_e(()=>{s.fetchWorkflowStatus()});function D(){j.value=!0}const j=R(!1);function z(){j.value=!1,s.resetWorkflow()}return(a,e)=>{const c=f("v-stepper-item"),n=f("v-stepper-header"),E=f("v-alert"),F=f("v-btn"),S=f("v-switch"),Q=f("v-icon"),q=f("v-data-table"),K=f("v-card"),oe=f("v-stepper-window-item"),se=f("v-stepper-window"),Y=f("v-stepper"),le=f("v-card-title"),t=f("v-card-text"),i=f("v-spacer"),T=f("v-card-actions"),B=f("v-dialog"),Z=f("v-container");return p(),x(X,null,[l(Z,{fluid:""},{default:o(()=>[l(Y,{modelValue:V(s).uiActiveIndex,"onUpdate:modelValue":[e[2]||(e[2]=_=>V(s).uiActiveIndex=_),e[3]||(e[3]=_=>V(s).requestUiActiveIndex(Number(_)))]},{default:o(()=>[l(n,null,{default:o(()=>[(p(!0),x(X,null,ae(V(s).workflowSteps,(_,L)=>(p(),O(c,{key:_.id,title:_.stepName,value:L,complete:V(s).isStepComplete(L),error:V(s).isStepWithIssues(L),rules:[()=>!V(s).isStepWithIssues(L)],subtitle:V(s).isStepError(L)?"erreurs de validation":V(s).isStepWarning(L)?"avertissements":"","complete-icon":"mdi-check"},null,8,["title","value","complete","error","rules","subtitle"]))),128))]),_:1}),l(se,null,{default:o(()=>[(p(!0),x(X,null,ae(V(s).workflowSteps,(_,L)=>(p(),O(oe,{key:`${_.id}-content`,value:L},{default:o(()=>[L===V(s).uiActiveIndex&&V(s).currentValidationMessages&&V(s).currentValidationMessages.length?(p(),x("div",Rt,[l(E,{type:"warning",dense:""},{default:o(()=>e[8]||(e[8]=[$(" This step has validation messages. Fix them or re-run validation. ",-1)])),_:1,__:[8]}),l(q,{items:V(s).currentValidationMessages,"item-value":"Message",headers:u,"group-by":[{key:"ValidatorName",order:"asc"}],class:"mt-2","hide-default-footer":""},{"group-header":o(({item:A,columns:ee,toggleGroup:te,isGroupOpen:re})=>[r("tr",null,[r("td",{colspan:ee.length,class:"cursor-pointer",onClick:ta=>te(A)},[r("div",Tt,[l(F,{icon:re(A)?"$expand":"$next",color:"medium-emphasis",density:"comfortable",size:"small",variant:"outlined"},null,8,["icon"]),r("span",At,N(A.value||"(validator)"),1)])],8,Nt)])]),"item.Status":o(({item:A})=>[r("div",null,N(d(A.Status)),1)]),"item.FileName":o(({item:A})=>[r("div",null,N(U(A)),1)]),"item.data-table-expand":o(({item:A})=>[l(K,{flat:"",class:"ma-2 pa-3"},{default:o(()=>[r("div",Mt,[e[10]||(e[10]=r("div",null,[r("strong",null,"Details"),r("span",{class:"ml-2 text--secondary"},"(grouped by validator when available)")],-1)),r("div",Vt,[l(S,{"model-value":m(A),label:m(A)?"Raw JSON":"Structured","hide-details":"","onUpdate:modelValue":()=>b(A)},null,8,["model-value","label","onUpdate:modelValue"]),l(F,{icon:"",small:"",class:"ml-2",onClick:Ae(ee=>M(A),["prevent"]),title:"Copy raw JSON"},{default:o(()=>[l(Q,{small:""},{default:o(()=>e[9]||(e[9]=[$("mdi-content-copy",-1)])),_:1,__:[9]})]),_:2},1032,["onClick"])])]),r("div",It,[m(A)?(p(),x("div",Et,[r("pre",Ft,N(JSON.stringify(A.ErrorData,null,2)),1)])):(p(),x("div",Wt,[A.ErrorData?(p(),x("div",Ot,[(p(!0),x(X,null,ae(P(A.ErrorData),(ee,te)=>(p(),x("div",{key:te,class:"mb-3"},[r("div",Pt,N(te),1),r("div",null,[v(te)?(p(),x("div",Bt,[l(q,{dense:"",items:H(ee),headers:[{title:"File",key:"filename"},{title:"Message",key:"message"}],"hide-default-footer":"",class:"mt-2"},null,8,["items"])])):W(te)?(p(),x("div",Dt,[l(q,{dense:"",items:[{filename:A.errorData&&A.errorData.length?A.errorData.join(", "):"(expected columns)",message:"This file does not respect the expected template: "+(A.errorData&&A.errorData.length?A.errorData.join(", "):"")}],headers:[{title:"File",key:"filename"},{title:"Message",key:"message"}],"hide-default-footer":"",class:"mt-2"},null,8,["items"])])):(p(),x("div",Ut,[l(q,{dense:"",items:k(ee),headers:I(ee),"hide-default-footer":"",class:"mt-2"},{"item._detail":o(({item:re})=>[r("div",jt,[r("pre",Lt,N(typeof re._detail=="object"?JSON.stringify(re._detail,null,2):String(re._detail)),1)])]),_:2},1032,["items","headers"])]))])]))),128))])):(p(),x("div",Jt,e[11]||(e[11]=[r("em",null,"No extra details available",-1)])))]))])]),_:2},1024)]),_:1},8,["items"]),r("div",zt,[l(F,{color:"primary",onClick:e[0]||(e[0]=A=>V(s).revalidateCurrent())},{default:o(()=>e[12]||(e[12]=[$("Re-validate",-1)])),_:1,__:[12]}),h.value?(p(),O(F,{key:0,color:"secondary",onClick:e[1]||(e[1]=A=>V(s).forceNext())},{default:o(()=>e[13]||(e[13]=[$("Force Next",-1)])),_:1,__:[13]})):G("",!0)])])):G("",!0),r("div",null,[_.stepName==="Upload inventory"?(p(),O(at,{key:0})):_.stepName==="RWA Category Manager"?(p(),O(gt,{key:1})):_.stepName==="BDD Manager"?(p(),O(ht,{key:2})):_.stepName==="RAF Manager"?(p(),O(Ct,{key:3})):_.stepName==="Fichier Enrichie Generation"?(p(),O($t,{key:4})):(p(),x("div",Ht,[r("p",null,"Step component not found: "+N(_.stepName),1)]))])]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"]),r("div",qt,[l(F,{onClick:e[4]||(e[4]=_=>V(s).navigatePrevVisual()),disabled:(V(s).uiActiveIndex??0)===0},{default:o(()=>e[14]||(e[14]=[$("Previous",-1)])),_:1,__:[14]},8,["disabled"]),l(F,{color:"error",class:"mx-2",onClick:D},{default:o(()=>e[15]||(e[15]=[$("Reset",-1)])),_:1,__:[15]}),l(F,{onClick:e[5]||(e[5]=_=>V(s).navigateNextVisual()),disabled:!V(s).canNavigateNext()},{default:o(()=>e[16]||(e[16]=[$("Next",-1)])),_:1,__:[16]},8,["disabled"])]),l(B,{modelValue:j.value,"onUpdate:modelValue":e[7]||(e[7]=_=>j.value=_),width:"480"},{default:o(()=>[l(K,null,{default:o(()=>[l(le,null,{default:o(()=>e[17]||(e[17]=[$("Confirm Reset",-1)])),_:1,__:[17]}),l(t,null,{default:o(()=>e[18]||(e[18]=[$("Reset workflow and clear imported inventory? This cannot be undone.",-1)])),_:1,__:[18]}),l(T,null,{default:o(()=>[l(i),l(F,{text:"",onClick:e[6]||(e[6]=_=>j.value=!1)},{default:o(()=>e[19]||(e[19]=[$("Cancel",-1)])),_:1,__:[19]}),l(F,{color:"error",onClick:z},{default:o(()=>e[20]||(e[20]=[$("Reset",-1)])),_:1,__:[20]})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(Ze)],64)}}}),Kt={class:"d-flex align-center"},Xt=ne({__name:"GlobalToast",setup(y){const s=ie(),u=J(()=>s.queue);function g(b){s.removeToast(b)}return(b,m)=>{const w=f("v-icon"),P=f("v-btn"),C=f("v-snackbar");return p(),x("div",null,[(p(!0),x(X,null,ae(u.value,(I,k)=>(p(),O(C,{key:I.id,"model-value":!0,location:"top right",timeout:"6000",style:Me({"margin-top":`${k*64}px`}),"onUpdate:modelValue":()=>g(I.id)},{actions:o(()=>[l(P,{text:"",onClick:v=>g(I.id)},{default:o(()=>m[1]||(m[1]=[$("Close",-1)])),_:2,__:[1]},1032,["onClick"])]),default:o(()=>[r("div",Kt,[l(w,{class:"me-2",color:I.type==="warning"?"warning":I.type==="error"?"error":"primary"},{default:o(()=>m[0]||(m[0]=[$("mdi-alert-circle",-1)])),_:2,__:[0]},1032,["color"]),r("span",null,N(I.message),1)])]),_:2},1032,["style","onUpdate:modelValue"]))),128))])}}}),Qt=ne({__name:"App",setup(y){const s=fe();return(u,g)=>{const b=f("v-progress-linear"),m=f("v-main"),w=f("v-app");return p(),O(w,null,{default:o(()=>[l(m,null,{default:o(()=>[l(Gt),l(Xt),V(s).isPosting?(p(),O(b,{key:0,indeterminate:"",color:"primary",height:"4",fixed:"",bottom:""})):G("",!0)]),_:1})]),_:1})}}}),ge=Ve(Qt),Yt=Ie(),Zt=Se({components:Ne,directives:Re,icons:{defaultSet:"mdi",aliases:$e,sets:{mdi:xe}},theme:{defaultTheme:"light"}});ge.use(Yt);ge.use(Zt);const be=document.getElementById("app");be?ge.mount(be):console.warn("Vue mount skipped: #app not found on this page.");const ea=me();ea.initSignalR();
