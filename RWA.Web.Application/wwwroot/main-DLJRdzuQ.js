import{c as he,m as be,a as ke,d as Ce,b as Se}from"./vuetify-vendor-DULFUn6R.js";import{a4 as ge,d as x,r as xe,f as U,a5 as Re,j as ie,w as fe,a3 as d,a6 as F,a7 as c,a8 as o,a9 as S,X as R,n as r,aa as K,y as v,F as se,ab as le,u as M,S as V,D as ye,a0 as Ne,J as Te,ac as Ae,ad as Me}from"./vendor-DgrpDgjj.js";import{H as Ve}from"./signalr-vendor-BwjK9eZE.js";const re=ge("toast",()=>{const m=x([]);let s=1;function i(p){const g={id:s++,type:p.type||"info",message:p.message||""};return m.value.push(g),g.id}function _(p){m.value=m.value.filter(g=>g.id!==p)}function C(){m.value=[]}return{queue:m,pushToast:i,removeToast:_,clear:C}}),Fe=xe({isPosting:!1});function ce(){return Fe}async function ue(m,s){const i=ce();i.isPosting=!0;try{const _=await fetch(m,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});return _.status===204?null:await _.json()}finally{const _=ce();_.isPosting=!1}}const de=ge("workflow",()=>{const m=x([]),s=U(()=>{const t=m.value.find(l=>l.status&&l.status.startsWith("Current"));if(!t||!t.dataPayload)return[];try{const l=JSON.parse(t.dataPayload);return Array.isArray(l)?l:[]}catch(l){return console.warn("[workflow.ts] Failed to parse DataPayload as validation messages:",l),[]}}),i=x(null),_=m,C=s,p=x(null),g=x(!1),O=x({}),h=x(null),$=x(0),w=x(["SuccessfulFinish","FinishedWithWarning"]),u=x(["CurrentWithError"]),I=x(["CurrentWithWarning"]);function z(t){m.value=t;const l=t.findIndex(N=>N.status&&N.status.startsWith("Current"));i.value=l>=0?l:0}function P(){return m.value.findIndex(t=>t.status&&t.status.startsWith("Current"))}function b(t){if(t==null)return;const l=P(),N=l>=0?l:Math.max(0,m.value.length-1);let W=Math.floor(Number(t)||0);W<0&&(W=0),W>N&&(W=N),i.value=W}let D=0;const H=2e3;async function q(){const t=Date.now();if(t-D<H){console.log("fetchWorkflowStatus throttled");return}D=t,g.value=!0,h.value=null;try{const l=await fetch("/api/workflow/status");if(!l.ok)throw new Error("Failed to fetch workflow status");const N=await l.json();z(Array.isArray(N)?N:[])}catch(l){l instanceof Error?h.value={errorMessage:l.message}:h.value={errorMessage:"An unknown error occurred"}}finally{g.value=!1}}async function B(){g.value=!0,h.value=null;try{await ue("/api/workflow/revalidate",{})}catch(t){t instanceof Error?h.value={errorMessage:t.message}:h.value={errorMessage:"An unknown error occurred"}}finally{g.value=!1}}async function j(){g.value=!0,h.value=null;try{await ue("/api/workflow/force-next",{})}catch(t){t instanceof Error?h.value={errorMessage:t.message}:h.value={errorMessage:"An unknown error occurred"}}finally{g.value=!1}}async function a(t){g.value=!0,h.value=null;try{await ue(`/api/workflow/trigger/${t}`,{})}catch(l){l instanceof Error?h.value={errorMessage:l.message}:h.value={errorMessage:"An unknown error occurred"}}finally{g.value=!1}}async function e(){g.value=!0,h.value=null;try{await ue("/api/workflow/reset",{}),$.value++}catch(t){t instanceof Error?h.value={errorMessage:t.message}:h.value={errorMessage:"An unknown error occurred"}}finally{g.value=!1}}function n(t,l){if(!t)return;const N={...O.value};N[t]=l,O.value=N}async function y(t){var N;g.value=!0,h.value=null;const l=ce();l.isPosting=!0;try{await Re.post("/api/workflow/upload",t)}catch(W){const k=re();if(W.response&&W.response.data){h.value=W.response.data;try{k.pushToast({type:"error",message:typeof W.response.data=="string"?W.response.data:((N=W.response.data)==null?void 0:N.message)||JSON.stringify(W.response.data)})}catch{}}else{h.value={errorMessage:"An unknown error occurred."};try{k.pushToast({type:"error",message:"Upload failed: unknown error"})}catch{}}}finally{g.value=!1,l.isPosting=!1}}function E(t){if(t<0)return!1;const l=m.value[t];return!l||!l.status?!1:w.value.includes(l.status)}function f(t){if(t<0)return!1;const l=m.value[t];return!l||!l.status?!1:w.value.includes(l.status)}function X(t){if(t<0)return!1;const l=m.value[t];return!l||!l.status?!1:u.value.includes(l.status)?!0:l.status.toLowerCase().includes("error")}function G(t){if(t<0)return!1;const l=m.value[t];return!l||!l.status?!1:I.value.includes(l.status)?!0:l.status.toLowerCase().includes("warning")}function J(t){return X(t)||G(t)}function Q(){p.value=new Ve().withUrl("/workflowHub").build(),p.value.on("ReceiveWorkflowUpdate",t=>{console.log("[workflow.ts] Received workflow update:",t),console.log("[workflow.ts] Before update - Current step:",m.value.find(l=>{var N;return(N=l.status)==null?void 0:N.startsWith("Current")})),z(Array.isArray(t)?t:[]),console.log("[workflow.ts] After update - Current step:",m.value.find(l=>{var N;return(N=l.status)==null?void 0:N.startsWith("Current")})),console.log("[workflow.ts] Validation messages count:",s.value.length)}),p.value.on("ReceiveTransition",t=>{window.dispatchEvent(new CustomEvent("workflow-transition",{detail:t}))}),p.value.on("ReceiveToast",t=>{try{re().pushToast(t||{})}catch{window.dispatchEvent(new CustomEvent("workflow-toast",{detail:t}))}}),p.value.start().catch(t=>console.error(t)),q(),fetch("/api/workflow/config").then(t=>t.ok?t.json():null).then(t=>{t&&(Array.isArray(t.AdvanceStatuses)&&(w.value=t.AdvanceStatuses),Array.isArray(t.ErrorStatuses)&&(u.value=t.ErrorStatuses))}).catch(()=>{})}function ae(t){b(t)}function Y(){const t=i.value??P();b((t??0)+1)}function ne(){const t=i.value??P();b((t??0)-1)}function Z(){const t=i.value??P();if(t==null||t>=m.value.length-1)return!1;for(let l=0;l<=t;l++)if(!E(l))return!1;return!0}return{workflowSteps:_,loading:g,error:h,currentValidationMessages:C,advanceStatuses:w,errorStatuses:u,stepLoading:O,setStepLoading:n,fetchWorkflowStatus:q,triggerTransition:a,resetWorkflow:e,uploadFiles:y,isStepAdvancable:E,isStepComplete:f,isStepError:X,isStepWarning:G,isStepWithIssues:J,initSignalR:Q,revalidateCurrent:B,forceNext:j,uiActiveIndex:i,navigateTo:ae,navigateNextVisual:Y,navigatePrevVisual:ne,requestUiActiveIndex:b,canNavigateNext:Z}}),we=/^RWA_Report_(\d{3})_(\d{2})(\d{4})/;function $e(m){return m?we.test(m):!1}function me(m){const s=Array.isArray(m)?m:Array.from(m),i=[],_=[];return s.forEach(C=>{const p=typeof C=="string"?C:(C==null?void 0:C.name)??String(C);if(!$e(p))i.push(p);else{const g=p.match(we);_.push(g?g[0]:"")}}),{valid:i.length===0,badNames:i,parsedMatches:_}}const Ie={key:1},Ee=ie({__name:"UploadInventory",setup(m){const s=de(),i=x([]),_=x(""),C=x(null),p=x(!0),g=U(()=>{const w=s.workflowSteps.find(u=>u.stepName==="Upload inventory");return(w==null?void 0:w.status)==="SuccessfulFinish"});fe(i,w=>{const u=me(w||[]);(!C.value||JSON.stringify(C.value.badNames)!==JSON.stringify(u.badNames))&&(C.value=u,p.value=u.valid,u.valid||(_.value=`Invalid filenames: ${u.badNames.join(", ")}`,re().pushToast({type:"warning",message:_.value})))},{deep:!0}),fe(()=>s.workflowSteps,w=>{const u=(w||[]).find(I=>I.stepName==="Upload inventory");(!u||!u.dataPayload)&&(i.value=[])},{deep:!0}),fe(()=>s.resetCounter,()=>{i.value=[]});const O=async()=>{const w=me(i.value||[]);if(!w.valid){_.value=`Invalid filenames: ${w.badNames.join(", ")}`,re().pushToast({type:"warning",message:_.value});return}const u=new FormData;for(const I of i.value)u.append("file",I);await s.uploadFiles(u),i.value=[]},h=U(()=>{const w=s.workflowSteps.find(I=>I.status.startsWith("Current"));if(!w||!w.dataPayload)return[];const u=JSON.parse(w.dataPayload);return u.Messages?u.Messages[0].ErrorData:[]}),$=U(()=>{const w=s.workflowSteps.find(I=>I.status.startsWith("Current"));if(!w||!w.dataPayload)return null;const u=JSON.parse(w.dataPayload);return u.Messages?u.Messages[0].Message:null});return(w,u)=>{const I=d("v-alert"),z=d("v-chip"),P=d("v-file-input"),b=d("v-btn"),D=d("v-col"),H=d("v-row"),q=d("v-data-table"),B=d("v-container");return c(),F(B,null,{default:o(()=>[g.value?(c(),F(I,{key:0,type:"success",variant:"outlined",class:"mb-4"},{default:o(()=>u[2]||(u[2]=[R(" This step is successfully finished. ",-1)])),_:1,__:[2]})):(c(),S("div",Ie,[r(H,null,{default:o(()=>[r(D,null,{default:o(()=>[u[5]||(u[5]=v("h3",null,"Upload Inventory Files",-1)),r(P,{modelValue:i.value,"onUpdate:modelValue":u[0]||(u[0]=j=>i.value=j),"show-size":1e3,color:"deep-purple-accent-4",label:"File input",placeholder:"Select your files",variant:"outlined",counter:"",multiple:"",accept:".xlsx"},{selection:o(({fileNames:j})=>[(c(!0),S(se,null,le(j,(a,e)=>(c(),F(z,{key:a,class:"me-2",color:"deep-purple-accent-4",size:"small",label:"",closable:"","onClick:close":n=>i.value.splice(e,1)},{default:o(()=>[R(V(a),1)]),_:2},1032,["onClick:close"]))),128))]),_:1},8,["modelValue"]),r(b,{onClick:O,disabled:i.value.length===0||!p.value},{default:o(()=>u[3]||(u[3]=[R("Upload",-1)])),_:1,__:[3]},8,["disabled"]),$.value?(c(),F(b,{key:0,onClick:u[1]||(u[1]=j=>M(s).triggerTransition("Revalidate"))},{default:o(()=>u[4]||(u[4]=[R("Revalidate",-1)])),_:1,__:[4]})):K("",!0)]),_:1,__:[5]})]),_:1}),$.value?(c(),F(H,{key:0},{default:o(()=>[r(D,null,{default:o(()=>[r(I,{type:"error",class:"mb-4"},{default:o(()=>[R(V($.value),1)]),_:1}),r(q,{headers:[{title:"Identifiant Origine",value:"IdentifiantOrigine"}],items:h.value},null,8,["items"])]),_:1})]),_:1})):K("",!0)]))]),_:1})}}}),We={key:1},Oe={key:0},Pe={key:1,class:"text-center py-8"},Be={key:2},Ue={class:"text-caption text--secondary"},je={class:"font-weight-medium"},De={class:"text-body-2"},Je={class:"text-body-2"},Le={style:{display:"flex",gap:"8px","align-items":"center"}},ze={style:{display:"flex",gap:"8px","align-items":"center"}},He={class:"d-flex gap-3"},qe={key:0,class:"text-caption text--secondary"},Ge={key:0,class:"ml-2 text--disabled"},Ke=ie({__name:"RwaCategoryManager",setup(m){const s=de(),i=x([]),_=x(!1),C=x(!0),p=x({}),g=x({}),O=x({}),h=x(""),$=x([]),w=x([]),u=U(()=>{if(!h.value||h.value.trim()==="")return i.value;const e=h.value.toLowerCase().trim();return i.value.filter(n=>b(n).toLowerCase().includes(e))}),I=U(()=>u.value.filter(e=>{const n=b(e);return p.value[n]}).length),z=U(()=>Object.keys(p.value).filter(e=>p.value[e]).length);function P(e){O.value[e]=!0}function b(e){return e.Identifiant||""}function D(e){const n=b(e),y=p.value[n],E=g.value[n];return y&&E?"row-complete":y?"row-partial":"row-incomplete"}const H=[{title:"Identifiant",value:"Identifiant"},{title:"Source",value:"Source"},{title:"Cat1",value:"Cat1"},{title:"Cat2",value:"Cat2"},{title:"Categorie RWA",value:"categorieRwa"},{title:"Type Bloomberg",value:"typeBloomberg"}];ye(async()=>{_.value=!0;try{const e=s.workflowSteps.find(n=>n.stepName==="RWA Category Manager");if(console.log("RWA Category Manager step:",e),e!=null&&e.dataPayload){console.log("Raw dataPayload:",e.dataPayload);const n=JSON.parse(e.dataPayload);console.log("Parsed payload:",n),console.log("Payload keys:",Object.keys(n)),i.value=n.MissingMappingRows||n.missingMappingRows||[],console.log("Loaded rows:",i.value);const y=n.CategorieRwaOptions||n.categorieRwaOptions||[],E=n.TypeBloombergOptions||n.typeBloombergOptions||[];console.log("Raw Categorie options from payload:",y),console.log("First categorie option structure:",y[0]),$.value=y.map(f=>({title:f.Libelle||f.libelle||f.Title||f.title,value:f.IdCatRwa||f.idCatRwa||f.Value||f.value||f.Id||f.id})),console.log("Mapped Categorie options:",$.value),console.log("categorieRwaOptions.value length:",$.value.length),console.log("Raw Type Bloomberg options from payload:",E),console.log("First type bloomberg option structure:",E[0]),w.value=E.map(f=>({title:f.Libelle||f.libelle||f.Title||f.title,value:f.IdTypeBloomberg||f.idTypeBloomberg||f.Value||f.value||f.Id||f.id})),console.log("Mapped Type Bloomberg options:",w.value),console.log("typeBloombergOptions.value length:",w.value.length),i.value.forEach(f=>{p.value[f.Identifiant]=f.ChosenCategorieRwa||null,g.value[f.Identifiant]=f.ChosenTypeBloomberg||null,O.value[f.Identifiant]=!1})}}finally{_.value=!1}});const q=U(()=>i.value.some(e=>!p.value[b(e)])),B=U(()=>{const e=s.workflowSteps.find(n=>n.stepName==="RWA Category Manager");return(e==null?void 0:e.status)==="SuccessfulFinish"});async function j(){_.value=!0;try{const e=i.value.filter(n=>p.value[b(n)]).map(n=>({identifiant:b(n),source:n.Source||n.source,cat1:n.Cat1||n.cat1,cat2:n.Cat2||n.cat2,categorieRwaId:p.value[b(n)],typeBloombergId:g.value[b(n)]||null}));if(e.length>0&&!(await fetch("/api/workflow/rwa-mappings",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({mappings:e})})).ok)throw new Error("Failed to submit mappings")}finally{_.value=!1}}async function a(){const e=s.workflowSteps.find(n=>n.status&&n.status.startsWith("Current"));if(e!=null&&e.dataPayload){const n=JSON.parse(e.dataPayload);i.value=n.missingMappingRows||[]}}return(e,n)=>{const y=d("v-col"),E=d("v-row"),f=d("v-alert"),X=d("v-skeleton-loader"),G=d("v-icon"),J=d("v-progress-circular"),Q=d("v-text-field"),ae=d("v-spacer"),Y=d("v-select"),ne=d("v-data-table"),Z=d("v-btn"),t=d("v-form"),l=d("v-card-text"),N=d("v-card"),W=d("v-container");return c(),F(W,null,{default:o(()=>[r(N,null,{default:o(()=>[r(l,null,{default:o(()=>[B.value?(c(),F(f,{key:0,type:"success",prominent:"",border:"start",class:"mb-6"},{default:o(()=>[r(E,{align:"center"},{default:o(()=>[r(y,{class:"grow"},{default:o(()=>n[2]||(n[2]=[R(" This step is successfully finished ",-1)])),_:1,__:[2]})]),_:1})]),_:1})):(c(),S("div",We,[r(t,{ref:"form",modelValue:C.value,"onUpdate:modelValue":n[1]||(n[1]=k=>C.value=k)},{default:o(()=>[_.value?(c(),S("div",Oe,[r(X,{type:"table",loading:_.value,"aria-busy":"true"},null,8,["loading"])])):i.value.length===0?(c(),S("div",Pe,[r(G,{size:"48",color:"grey",class:"mb-4"},{default:o(()=>n[3]||(n[3]=[R("mdi-table-search",-1)])),_:1,__:[3]}),n[4]||(n[4]=v("h3",{class:"text-h6 grey--text mb-2"},"Waiting for category mapping data...",-1)),n[5]||(n[5]=v("p",{class:"text-body-2 grey--text"},"The system is processing category mappings via SignalR.",-1)),r(J,{indeterminate:"",color:"primary",class:"mt-4"})])):(c(),S("div",Be,[r(E,{class:"mb-4"},{default:o(()=>[r(y,{cols:"12",md:"6"},{default:o(()=>[r(Q,{modelValue:h.value,"onUpdate:modelValue":n[0]||(n[0]=k=>h.value=k),"prepend-inner-icon":"mdi-magnify",label:"Search by Identifiant...",outlined:"",dense:"",clearable:"","hide-details":"",placeholder:"Filter rows by identifiant"},null,8,["modelValue"])]),_:1}),r(ae),r(y,{cols:"auto",class:"d-flex align-center"},{default:o(()=>[v("span",Ue,V(u.value.length)+" / "+V(i.value.length)+" rows ",1)]),_:1})]),_:1}),r(ne,{items:u.value,headers:H,"item-key":b,class:"elevation-1 rwa-data-table",role:"table","items-per-page":10,"footer-props":{"items-per-page-options":[5,10,20,-1]},"item-class":D,loading:_.value,"loading-text":"Loading category mappings..."},{"item.Identifiant":o(({item:k})=>[v("span",je,V(k.Identifiant),1)]),"item.Source":o(({item:k})=>[v("span",null,V(k.Source),1)]),"item.Cat1":o(({item:k})=>[v("span",De,V(k.Cat1),1)]),"item.Cat2":o(({item:k})=>[v("span",Je,V(k.Cat2||"-"),1)]),"item.categorieRwa":o(({item:k})=>[v("div",Le,[r(Y,{items:$.value,modelValue:p.value[b(k)],"onUpdate:modelValue":[A=>p.value[b(k)]=A,()=>P(b(k))],"item-title":"title","item-value":"value",variant:"outlined",density:"compact","hide-details":"",class:"rwa-select",placeholder:"Select RWA Category","prepend-inner-icon":"mdi-tag-outline",clearable:"",error:O.value[b(k)]&&!p.value[b(k)],"error-messages":O.value[b(k)]&&!p.value[b(k)]?["Required"]:[],onBlur:()=>P(b(k)),style:{"min-width":"250px"},"aria-label":`Categorie RWA for ${b(k)}`},null,8,["items","modelValue","onUpdate:modelValue","error","error-messages","onBlur","aria-label"])])]),"item.typeBloomberg":o(({item:k})=>[v("div",ze,[r(Y,{items:w.value,modelValue:g.value[b(k)],"onUpdate:modelValue":A=>g.value[b(k)]=A,"item-title":"title","item-value":"value",variant:"outlined",density:"compact","hide-details":"",class:"rwa-select",placeholder:"Select Bloomberg Type (Optional)","prepend-inner-icon":"mdi-chart-line",clearable:"",style:{"min-width":"280px"},"aria-label":`Type Bloomberg for ${b(k)}`},null,8,["items","modelValue","onUpdate:modelValue","aria-label"])])]),_:1},8,["items","loading"]),r(E,{class:"mt-6"},{default:o(()=>[r(y,{cols:"12",class:"d-flex justify-space-between align-center"},{default:o(()=>[v("div",He,[r(Z,{disabled:!C.value||q.value||_.value,color:"primary",elevation:"2",large:"",onClick:j,"aria-label":"Submit mappings"},{default:o(()=>[r(G,{left:""},{default:o(()=>[R(V(_.value?"mdi-loading mdi-spin":"mdi-check-circle"),1)]),_:1}),_.value?(c(),F(J,{key:0,indeterminate:"",size:"18",width:"2",color:"white",class:"mr-2"})):K("",!0),R(" "+V(_.value?"Submitting...":"Submit Mappings"),1)]),_:1},8,["disabled"]),r(Z,{outlined:"",color:"secondary",large:"",onClick:a,"aria-label":"Reload missing rows"},{default:o(()=>[r(G,{left:""},{default:o(()=>n[6]||(n[6]=[R("mdi-refresh",-1)])),_:1,__:[6]}),n[7]||(n[7]=R(" Reload Data ",-1))]),_:1,__:[7]})]),u.value.length>0?(c(),S("div",qe,[R(V(I.value)+" / "+V(u.value.length)+" mapped ",1),h.value&&u.value.length!==i.value.length?(c(),S("span",Ge," ("+V(z.value)+" / "+V(i.value.length)+" total) ",1)):K("",!0)])):K("",!0)]),_:1})]),_:1})]))]),_:1},8,["modelValue"])]))]),_:1})]),_:1})]),_:1})}}}),pe=(m,s)=>{const i=m.__vccOpts||m;for(const[_,C]of s)i[_]=C;return i},Xe=pe(Ke,[["__scopeId","data-v-94d95b13"]]),Qe={};function Ye(m,s){return c(),S("div",null,s[0]||(s[0]=[v("h3",null,"BDD Manager",-1),v("p",null,"Content for this step goes here.",-1)]))}const Ze=pe(Qe,[["render",Ye]]),et={};function tt(m,s){return c(),S("div",null,s[0]||(s[0]=[v("h3",null,"RAF Manager",-1),v("p",null,"Content for this step goes here.",-1)]))}const at=pe(et,[["render",tt]]),nt={};function ot(m,s){return c(),S("div",null,s[0]||(s[0]=[v("h3",null,"Fichier Enrichi Generation",-1),v("p",null,"Content for this step goes here.",-1)]))}const st=pe(nt,[["render",ot]]),lt={key:0},rt=["colspan","onClick"],it={class:"d-flex align-center"},ut={class:"ms-4"},ct={class:"d-flex align-center justify-space-between"},dt={class:"d-flex align-center"},pt={class:"mt-3"},ft={key:0},vt={style:{"white-space":"pre-wrap","word-break":"break-word","max-height":"360px",overflow:"auto"}},mt={key:1},_t={key:0},gt={class:"font-weight-medium"},yt={key:0},wt={key:1},ht={key:2},bt={style:{padding:"6px 8px"}},kt={style:{"white-space":"pre-wrap","word-break":"break-word",margin:"0"}},Ct={key:1},St={class:"mt-2"},xt={key:5},Rt={class:"d-flex justify-space-between mt-4"},Nt=ie({__name:"WorkflowView",setup(m){const s=de(),i=[{title:"Type",key:"Status"},{title:"File",key:"FileName"},{title:"Message",key:"Message"}],_=x({});function C(a){const e=g(a);_.value[e]=!_.value[e]}function p(a){return!!_.value[g(a)]}function g(a){return a?a.id?`id:${a.id}`:a.message?`msg:${a.message}`:JSON.stringify(a).slice(0,64):"__unknown__"}function O(a){if(!a)return{};if(Array.isArray(a)){const e={};return a.forEach(n=>{const y=n&&(n.validator||n.name)||"details";e[y]||(e[y]=[]),e[y].push(n)}),e}if(typeof a=="object"){const e=Object.keys(a);return e.length>0&&e.some(y=>typeof a[y]!="string")?a:{details:[a]}}return{details:[a]}}function h(a){if(!Array.isArray(a)||a.length===0)return[];const e=a[0];return!e||typeof e!="object"||Array.isArray(e)?[]:Object.keys(e)}function $(a){const e=h(a);return e.length>0?e.map(n=>({title:n,key:n})):[{title:"Details",key:"_detail"}]}function w(a){return a?Array.isArray(a)?a.map(e=>e&&typeof e=="object"?e:{_detail:e}):[{_detail:a}]:[]}function u(a){return!!a&&a.toLowerCase().includes("assetid")}function I(a){return!!a&&a.toLowerCase().includes("uploadtemplate")}function z(a){return a?Array.isArray(a)?a.map(e=>({filename:((e==null?void 0:e.SavedFilePath)??(e==null?void 0:e.FileName)??(e==null?void 0:e.Fichier)??(e==null?void 0:e.filename)??(e==null?void 0:e.fileName)??"")||"(unknown file)",message:"This file contains empty Asset IDs"})):[{filename:"(unknown file)",message:String(a)}]:[]}function P(a){var n,y;return a?((a==null?void 0:a.FileName)??(a==null?void 0:a.fileName)??((n=a==null?void 0:a.ErrorData)==null?void 0:n.SavedFilePath)??((y=a==null?void 0:a.errorData)==null?void 0:y.FileName))||"(general validation)":""}function b(a){if(!a)return"";if(typeof a=="number")return a===2?"Error":a===1?"Warning":"Success";const e=String(a).toLowerCase();return e.includes("error")?"Error":e.includes("warning")?"Warning":String(a)}const D=U(()=>(s.currentValidationMessages||[]).some(e=>b(e.status)==="Warning"));async function H(a){const e=a&&(a.errorData??a.ErrorData??a),n=typeof e=="object"?JSON.stringify(e,null,2):String(e??"");try{if(navigator&&navigator.clipboard&&navigator.clipboard.writeText){await navigator.clipboard.writeText(n);return}}catch{}try{const y=document.createElement("textarea");y.value=n,y.style.position="fixed",y.style.left="-9999px",document.body.appendChild(y),y.select(),document.execCommand("copy"),document.body.removeChild(y)}catch{const E=window.open("","_blank");E&&(E.document.write("<pre>"+n.replace(/</g,"&lt;")+"</pre>"),E.document.close())}}ye(()=>{s.fetchWorkflowStatus()});function q(){B.value=!0}const B=x(!1);function j(){B.value=!1,s.resetWorkflow()}return(a,e)=>{const n=d("v-stepper-item"),y=d("v-stepper-header"),E=d("v-alert"),f=d("v-btn"),X=d("v-switch"),G=d("v-icon"),J=d("v-data-table"),Q=d("v-card"),ae=d("v-stepper-window-item"),Y=d("v-stepper-window"),ne=d("v-stepper"),Z=d("v-card-title"),t=d("v-card-text"),l=d("v-spacer"),N=d("v-card-actions"),W=d("v-dialog"),k=d("v-container");return c(),F(k,{fluid:""},{default:o(()=>[r(ne,{modelValue:M(s).uiActiveIndex,"onUpdate:modelValue":[e[2]||(e[2]=A=>M(s).uiActiveIndex=A),e[3]||(e[3]=A=>M(s).requestUiActiveIndex(Number(A)))]},{default:o(()=>[r(y,null,{default:o(()=>[(c(!0),S(se,null,le(M(s).workflowSteps,(A,L)=>(c(),F(n,{key:A.id,title:A.stepName,value:L,complete:M(s).isStepComplete(L),error:M(s).isStepWithIssues(L),rules:[()=>!M(s).isStepWithIssues(L)],subtitle:M(s).isStepError(L)?"erreurs de validation":M(s).isStepWarning(L)?"avertissements":"","complete-icon":"mdi-check"},null,8,["title","value","complete","error","rules","subtitle"]))),128))]),_:1}),r(Y,null,{default:o(()=>[(c(!0),S(se,null,le(M(s).workflowSteps,(A,L)=>(c(),F(ae,{key:`${A.id}-content`,value:L},{default:o(()=>[L===M(s).uiActiveIndex&&M(s).currentValidationMessages&&M(s).currentValidationMessages.length?(c(),S("div",lt,[r(E,{type:"warning",dense:""},{default:o(()=>e[8]||(e[8]=[R(" This step has validation messages. Fix them or re-run validation. ",-1)])),_:1,__:[8]}),r(J,{items:M(s).currentValidationMessages,"item-value":"Message",headers:i,"group-by":[{key:"ValidatorName",order:"asc"}],class:"mt-2","hide-default-footer":""},{"group-header":o(({item:T,columns:ee,toggleGroup:te,isGroupOpen:oe})=>[v("tr",null,[v("td",{colspan:ee.length,class:"cursor-pointer",onClick:It=>te(T)},[v("div",it,[r(f,{icon:oe(T)?"$expand":"$next",color:"medium-emphasis",density:"comfortable",size:"small",variant:"outlined"},null,8,["icon"]),v("span",ut,V(T.value||"(validator)"),1)])],8,rt)])]),"item.Status":o(({item:T})=>[v("div",null,V(b(T.Status)),1)]),"item.FileName":o(({item:T})=>[v("div",null,V(P(T)),1)]),"item.data-table-expand":o(({item:T})=>[r(Q,{flat:"",class:"ma-2 pa-3"},{default:o(()=>[v("div",ct,[e[10]||(e[10]=v("div",null,[v("strong",null,"Details"),v("span",{class:"ml-2 text--secondary"},"(grouped by validator when available)")],-1)),v("div",dt,[r(X,{"model-value":p(T),label:p(T)?"Raw JSON":"Structured","hide-details":"","onUpdate:modelValue":()=>C(T)},null,8,["model-value","label","onUpdate:modelValue"]),r(f,{icon:"",small:"",class:"ml-2",onClick:Ne(ee=>H(T),["prevent"]),title:"Copy raw JSON"},{default:o(()=>[r(G,{small:""},{default:o(()=>e[9]||(e[9]=[R("mdi-content-copy",-1)])),_:1,__:[9]})]),_:2},1032,["onClick"])])]),v("div",pt,[p(T)?(c(),S("div",ft,[v("pre",vt,V(JSON.stringify(T.ErrorData,null,2)),1)])):(c(),S("div",mt,[T.ErrorData?(c(),S("div",_t,[(c(!0),S(se,null,le(O(T.ErrorData),(ee,te)=>(c(),S("div",{key:te,class:"mb-3"},[v("div",gt,V(te),1),v("div",null,[u(te)?(c(),S("div",yt,[r(J,{dense:"",items:z(ee),headers:[{title:"File",key:"filename"},{title:"Message",key:"message"}],"hide-default-footer":"",class:"mt-2"},null,8,["items"])])):I(te)?(c(),S("div",wt,[r(J,{dense:"",items:[{filename:T.errorData&&T.errorData.length?T.errorData.join(", "):"(expected columns)",message:"This file does not respect the expected template: "+(T.errorData&&T.errorData.length?T.errorData.join(", "):"")}],headers:[{title:"File",key:"filename"},{title:"Message",key:"message"}],"hide-default-footer":"",class:"mt-2"},null,8,["items"])])):(c(),S("div",ht,[r(J,{dense:"",items:w(ee),headers:$(ee),"hide-default-footer":"",class:"mt-2"},{"item._detail":o(({item:oe})=>[v("div",bt,[v("pre",kt,V(typeof oe._detail=="object"?JSON.stringify(oe._detail,null,2):String(oe._detail)),1)])]),_:2},1032,["items","headers"])]))])]))),128))])):(c(),S("div",Ct,e[11]||(e[11]=[v("em",null,"No extra details available",-1)])))]))])]),_:2},1024)]),_:1},8,["items"]),v("div",St,[r(f,{color:"primary",onClick:e[0]||(e[0]=T=>M(s).revalidateCurrent())},{default:o(()=>e[12]||(e[12]=[R("Re-validate",-1)])),_:1,__:[12]}),D.value?(c(),F(f,{key:0,color:"secondary",onClick:e[1]||(e[1]=T=>M(s).forceNext())},{default:o(()=>e[13]||(e[13]=[R("Force Next",-1)])),_:1,__:[13]})):K("",!0)])])):K("",!0),v("div",null,[A.stepName==="Upload inventory"?(c(),F(Ee,{key:0})):A.stepName==="RWA Category Manager"?(c(),F(Xe,{key:1})):A.stepName==="BDD Manager"?(c(),F(Ze,{key:2})):A.stepName==="RAF Manager"?(c(),F(at,{key:3})):A.stepName==="Fichier Enrichie Generation"?(c(),F(st,{key:4})):(c(),S("div",xt,[v("p",null,"Step component not found: "+V(A.stepName),1)]))])]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"]),v("div",Rt,[r(f,{onClick:e[4]||(e[4]=A=>M(s).navigatePrevVisual()),disabled:(M(s).uiActiveIndex??0)===0},{default:o(()=>e[14]||(e[14]=[R("Previous",-1)])),_:1,__:[14]},8,["disabled"]),r(f,{color:"error",class:"mx-2",onClick:q},{default:o(()=>e[15]||(e[15]=[R("Reset",-1)])),_:1,__:[15]}),r(f,{onClick:e[5]||(e[5]=A=>M(s).navigateNextVisual()),disabled:!M(s).canNavigateNext()},{default:o(()=>e[16]||(e[16]=[R("Next",-1)])),_:1,__:[16]},8,["disabled"])]),r(W,{modelValue:B.value,"onUpdate:modelValue":e[7]||(e[7]=A=>B.value=A),width:"480"},{default:o(()=>[r(Q,null,{default:o(()=>[r(Z,null,{default:o(()=>e[17]||(e[17]=[R("Confirm Reset",-1)])),_:1,__:[17]}),r(t,null,{default:o(()=>e[18]||(e[18]=[R("Reset workflow and clear imported inventory? This cannot be undone.",-1)])),_:1,__:[18]}),r(N,null,{default:o(()=>[r(l),r(f,{text:"",onClick:e[6]||(e[6]=A=>B.value=!1)},{default:o(()=>e[19]||(e[19]=[R("Cancel",-1)])),_:1,__:[19]}),r(f,{color:"error",onClick:j},{default:o(()=>e[20]||(e[20]=[R("Reset",-1)])),_:1,__:[20]})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}}}),Tt={class:"d-flex align-center"},At=ie({__name:"GlobalToast",setup(m){const s=re(),i=U(()=>s.queue);function _(C){s.removeToast(C)}return(C,p)=>{const g=d("v-icon"),O=d("v-btn"),h=d("v-snackbar");return c(),S("div",null,[(c(!0),S(se,null,le(i.value,($,w)=>(c(),F(h,{key:$.id,"model-value":!0,location:"top right",timeout:"6000",style:Te({"margin-top":`${w*64}px`}),"onUpdate:modelValue":()=>_($.id)},{actions:o(()=>[r(O,{text:"",onClick:u=>_($.id)},{default:o(()=>p[1]||(p[1]=[R("Close",-1)])),_:2,__:[1]},1032,["onClick"])]),default:o(()=>[v("div",Tt,[r(g,{class:"me-2",color:$.type==="warning"?"warning":$.type==="error"?"error":"primary"},{default:o(()=>p[0]||(p[0]=[R("mdi-alert-circle",-1)])),_:2,__:[0]},1032,["color"]),v("span",null,V($.message),1)])]),_:2},1032,["style","onUpdate:modelValue"]))),128))])}}}),Mt=ie({__name:"App",setup(m){const s=ce();return(i,_)=>{const C=d("v-progress-linear"),p=d("v-main"),g=d("v-app");return c(),F(g,null,{default:o(()=>[r(p,null,{default:o(()=>[r(Nt),r(At),M(s).isPosting?(c(),F(C,{key:0,indeterminate:"",color:"primary",height:"4",fixed:"",bottom:""})):K("",!0)]),_:1})]),_:1})}}}),ve=Ae(Mt),Vt=Me(),Ft=he({components:Se,directives:Ce,icons:{defaultSet:"mdi",aliases:ke,sets:{mdi:be}},theme:{defaultTheme:"light"}});ve.use(Vt);ve.use(Ft);const _e=document.getElementById("app");_e?ve.mount(_e):console.warn("Vue mount skipped: #app not found on this page.");const $t=de();$t.initSignalR();
